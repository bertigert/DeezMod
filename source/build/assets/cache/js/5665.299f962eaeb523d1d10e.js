"use strict";(self.webpackJsonpDeezer=self.webpackJsonpDeezer||[]).push([[5665],{"6VLJ":(e,t,i)=>{i.d(t,{B:()=>r,I:()=>n});const r={off:"off",on:"on",force:"force"},n={center:!1,play:r.off,preview:r.off,favorite:r.off,contextMenu:r.off,dislike:r.off}},F3Nm:(e,t,i)=>{i.d(t,{A:()=>S});var r,n,s=i("+9dH"),o=i("q1tI"),a=i("juqV"),_=i("X6oL"),l=i("Ty5D"),c=i("Wp0Y"),d=i("u7vQ"),p=i("nrKQ"),u=i("CxZw"),v=i("H/eQ"),y=i("Vd8Q"),h=i("5G9X"),g=i("hz5U"),A=i("Vynx"),w=i("TYt9"),m=i("h8EF"),E=i("6VLJ"),P=i("M5EV"),f=i("NgX8"),L=i("AfN5"),C=i("HmE0"),k=i("nN8/"),I=i("HQpa");let T=(0,_.Ay)()(((n=class extends o.Component{constructor(e,t){super(e,t),this.state={playing:this._getPlayingStatus(),isHover:!1,previewActive:!1},this._previewTimer=null,this._previewTimeout=500,this._naturalPreviewEnd=!1,this._updateOnAir=this._updateOnAir.bind(this),this._onNaturalPreviewEnd=this._onNaturalPreviewEnd.bind(this),this._onThumbnailClick=this._onThumbnailClick.bind(this),this._onPlay=this._onPlay.bind(this),this._onMouseEnter=this._onMouseEnter.bind(this),this._onMouseLeave=this._onMouseLeave.bind(this)}componentDidMount(){v.A.subscribe(v.A.player.finish,this._updateOnAir),v.A.subscribe(v.A.player.playing,this._updateOnAir),v.A.subscribe(v.A.player.finishPreview,this._onNaturalPreviewEnd),v.A.subscribe(v.A.thumbnail.togglePlay,this._onThumbnailClick)}UNSAFE_componentWillReceiveProps(e){this.setState({playing:this._getPlayingStatus(e)})}shouldComponentUpdate(e,t){return this.props.id!==e.id||this.props.presets.preview!==e.presets.preview||this.state.playing!==t.playing||this.state.isHover!==t.isHover||this.state.previewActive!==t.previewActive||this.props.trackListIndex!==e.trackListIndex}componentDidUpdate(e,t){this.props.presets.preview!==E.B.off&&t.previewActive!==this.state.previewActive&&this[this.state.previewActive?"_previewPlay":"_previewStop"](),this._updateOnAir()}componentWillUnmount(){p.A.cancel(this._previewApiRef),v.A.unsubscribe(v.A.player.finish,this._updateOnAir),v.A.unsubscribe(v.A.player.playing,this._updateOnAir),v.A.unsubscribe(v.A.player.finishPreview,this._onNaturalPreviewEnd),v.A.unsubscribe(v.A.thumbnail.togglePlay,this._onThumbnailClick)}render(){const{previewActive:e,isHover:t,playing:i}=this.state,{size:r}=this.props,{play:n,preview:_}=this.props.presets,l={className:(0,a.A)("action-item-tempo-btn",{"action-force":n===E.B.force,active:i}),type:"button","aria-label":i?(0,c.AP)("Pause"):(0,c.AP)("Play"),onMouseDown:this._togglePreview.bind(this,!0),onMouseUp:this._togglePreview.bind(this,!1),onMouseLeave:this._onMouseLeave,onMouseEnter:this._onMouseEnter};r&&(l.size=r);const d=o.createElement(k.Mk.Consumer,null,(({dynamicContentlogAction:r})=>o.createElement(C.K0,(0,s.A)({icon:o.createElement(P.A,{isHover:t||e,isActive:i||e,color:"black",size:"small"}),colorScheme:"white",shadow:"md",variant:"onDark",onClick:e=>this._onPlay(e,r)},l))));return _===E.B.off||i?d:o.createElement(f.m,{closeOnScroll:!0,delay:700,label:(0,c.AP)("Cliquer longuement pour Ã©couter un extrait"),placement:"top"},d)}_onPlay(e,t){const{context:i,type:r,moduleId:n,index:s,onClick:o}=this.props,{preview:a}=this.props.presets,_=a!==E.B.off;if(null==o||o(this.state.playing),_){if(this._naturalPreviewEnd)return void(this._naturalPreviewEnd=!1);if(this.state.previewActive)return void e.stopPropagation()}e.stopPropagation(),this._play(),t({action:k.D$.PLAY_CLICKED,payload:{module_id:n,play_type:k.$x.DIRECT_PLAY,item:{id:String(i.ID),type:"show"===r?I.S.SHOW:r,position:s+1}}})}_onMouseLeave(){this.setState({isHover:!1},this._togglePreview(!1))}_onMouseEnter(){this.setState({isHover:!0})}_onThumbnailClick(){const e=d.Ay.getContext();null!==e&&e.ID===this.props.id&&this._play()}_onNaturalPreviewEnd(){this.props.presets.preview!==E.B.off&&this.state.previewActive&&this._updatePreviewState(!1,!0)}_play(){const{presets:{preview:e},context:t,type:i,id:r,radio:n,trackList:s,trackListIndex:o}=this.props;if(e===E.B.force||(0,d._k)(d.Ay.getPlayerType()))return;if(this._shouldTogglePlayState())return A.A.intent((0,w.G)(d.Ay)),d.Ay.control.togglePause(),void(d.Ay.isPlaying()||this._triggerTracking());if("queuelist"===(t.TYPE||t))return A.A.intent("play"),d.Ay.playTrackAtIndex(this.props.trackListIndex),void this._triggerTracking();const a={type:i,id:r,radio:n,context:"string"==typeof t?{ID:r,TYPE:t}:t,data:s};"number"==typeof o&&(a.index=o),s.length>0&&(a.data=s),a.type===h.Ay.Track&&(a.forceAsFirstTrack=!0,a.type=L.Kk.TRACK_MIX,a.data=[],a.index=0),A.A.intent("play"),d.Ay.play(a),this._triggerTracking()}_shouldTogglePlayState(){const{context:e,trackListIndex:t,id:i,type:r}=this.props,n=e.TYPE||e;if("queuelist"===n)return Number(t)===d.Ay.getTrackListIndex();const s=d.Ay.getContext();if(s){const e=y.default.get("log_contexts")[s.TYPE]===y.default.get("log_contexts")[n];return r===h.Ay.Track?e&&String(i)===String(d.Ay.getCurrentSong("MEDIA_ID")):e&&String(s.ID)===String(i)}return!1}_getPlayingStatus(e){if(e=e||this.props,d.Ay.isPlaying()){const t=d.Ay.getContext(),i=t?t.ID:null,r=d.Ay.getCurrentSong("MEDIA_ID"),n=e.type===h.Ay.User?h.Ay.Flow:e.type;if(String(e.id)===String(r)||String(e.id)===String(i))return e.presets.isNotAnimatedFromTrackListIndex||e.type!==h.Ay.Episode||"number"!=typeof e.trackListIndex?n===h.Ay.Track?y.default.get("log_contexts")[t.TYPE]===n&&String(e.id)===String(r):y.default.get("log_contexts")[t.TYPE]===n&&e.radio===d.Ay.isRadio():e.trackListIndex===d.Ay.getIndexSong()}return!1}_updateOnAir(){const e=this._getPlayingStatus();this.setState({playing:e}),this.props.onChange&&this.props.onChange(e)}_togglePreview(e){this.props.presets.preview===E.B.off||e&&this.state.playing||(clearTimeout(this._previewTimer),e&&this.state.previewActive||(0,d._k)(d.Ay.getPlayerType())||(this._previewTimer=setTimeout((()=>{this._updatePreviewState(e)}),this._previewTimeout)))}_updatePreviewState(e,t){this.setState({previewActive:e},(()=>{this._naturalPreviewEnd=t}))}_previewPlay(){const{type:e,id:t}=this.props,i=g.A.getPreviewMethod(e,t);this._previewApiRef=p.A.call({method:i.method,data:i.data,success:e=>{const t=this._extractPreviewData(e.data),i=Number(t.GAIN),r=((t||{}).MEDIA||[]).filter((e=>"preview"===e.TYPE)).map((e=>Array.isArray(e.HREF)?e.HREF[0]:e.HREF)).shift();r?d.Ay.trigger("audioPlayer_startPreview",[r,i]):this._updatePreviewState(!1,!0)},error:()=>{this._updatePreviewState(!1,!0)}})}_previewStop(){p.A.cancel(this._previewApiRef),d.Ay.trigger("audioPlayer_endPreview")}_extractPreviewData(e){if(!Array.isArray(e)||!e.length)return null;if(!(e[0].MEDIA||[]).filter((e=>"preview"===e.TYPE)).length)return null;let t=e[0];if(Number(u.A.checkSongAvailable(t))!==Number(u.A.READABLE)){if(!t.FALLBACK)return null;t=t.FALLBACK}return t}_triggerTracking(){var e;const{id:t,context:i,type:r}=this.props,n=d.Ay.getContext();if(!this.props.tracking||!n||n.ID===t&&d.Ay.isPaused())return;const s=this.props.tracking.getTrackingData(),o=s.pagecategory||s.pagename;if(!o)return;const a=i.TYPE||i;null!==(e=this.props.match.url)&&void 0!==e&&e.includes("/profile/")&&(0,m.h4)({action:m.dJ.PLAY_CLICKED,payload:{path:this.props.match.params.tab||"home",contextType:a}}),this.props.tracking.trackEvent({eventaction:`click-play-${a}`,event:"click",eventcategory:o,eventlabel:`play-${a}`,item:{id:t,type:r,rank:s.index||0}})}}).defaultProps={id:null,radio:!1,context:"",trackList:[],trackListIndex:null,presets:E.I,onChange:void 0},r=n))||r;const S=(0,l.y)(T)},HQpa:(e,t,i)=>{i.d(t,{H:()=>r,S:()=>n});let r=function(e){return e.FETCH="elapsed_time_api",e.PARSE="elapsed_time_parsing",e.DISPLAY="elapsed_time_page_display",e}({}),n=function(e){return e.ARTIST="artist",e.ALBUM="album",e.SHOW="podcast",e.PLAYLIST="playlist",e.CHANNEL="channel",e.SONG="track",e.FLOW="flow",e.LIVESTREAM="livestream",e.EXTERNALLINK="promotionallink",e.VIDEO="video",e.SMARTTRACKLIST="smarttracklist",e.LIVEEVENT="liveevent",e.MIX="mix",e.MESSAGE="message",e.EPISODE="episode",e.USER="profile",e}({})},Hews:(e,t,i)=>{i.d(t,{A:()=>o});var r=i("q1tI"),n=i("AlG7"),s=i("DcKU");const o=({isActive:e=!1,size:t})=>e?r.createElement(n.C,{size:t,color:"icon.accent.primary.default"}):r.createElement(s.M,{size:t})},TYt9:(e,t,i)=>{i.d(t,{G:()=>r});const r=e=>e.isPaused()||e.isPlaying()?e.isPaused()?e.getPosition()?"resume":"play":"pause":"play"},"nN8/":(e,t,i)=>{i.d(t,{D$:()=>v,Mk:()=>y,$x:()=>u,i7:()=>h,D2:()=>g});var r=i("q1tI"),n=i("tZCQ"),s=i("LOQS"),o=i("HQK9");const a=new class{constructor(e){this._logCenter=void 0,this._logCenter=e}_isValideLog(e){const{screen_view_name:t,screen_view_id_type:i,screen_view_id:r,render_id:n,user_id:s}=e;return[t,i,r,n,s].every(Boolean)}log({screen_view_name:e,screen_view_id_type:t,screen_view_id:i,render_id:r,user_id:n}){this._isValideLog({screen_view_name:e,screen_view_id_type:t,screen_view_id:i,render_id:r,user_id:n})&&this._logCenter.log((0,o.L)("dynamic_content.screen_view","1.0.0",{screen_view_name:e,screen_view_id_type:t,screen_view_id:i,render_id:r,user_id:n}))}}(s.A),_=new class{constructor(e){this._logCenter=void 0,this._logCenter=e}_isValideLog(e){const{screen_view_name:t,screen_view_id_type:i,screen_view_id:r,render_id:n,module_id:s,user_id:o}=e;return[t,i,r,n,s,o].every(Boolean)}log({screen_view_name:e,screen_view_id_type:t,screen_view_id:i,render_id:r,module_id:n,user_id:s}){this._isValideLog({screen_view_name:e,screen_view_id_type:t,screen_view_id:i,render_id:r,module_id:n,user_id:s})&&this._logCenter.log((0,o.L)("dynamic_content.view_all_clicked","1.0.0",{screen_view_name:e,screen_view_id_type:t,screen_view_id:i,render_id:r,module_id:n,user_id:s}))}}(s.A),l=new class{constructor(e){this._logCenter=void 0,this._logCenter=e}_isValideLog(e){const{screen_view_name:t,screen_view_id_type:i,screen_view_id:r,render_id:n,module_id:s,item:o,user_id:a}=e;return[t,i,r,n,s,null==o?void 0:o.id,null==o?void 0:o.type,null==o?void 0:o.position,a].every(Boolean)}log({screen_view_name:e,screen_view_id_type:t,screen_view_id:i,render_id:r,module_id:n,item:s,user_id:a}){this._isValideLog({screen_view_name:e,screen_view_id_type:t,screen_view_id:i,render_id:r,module_id:n,item:s,user_id:a})&&this._logCenter.log((0,o.L)("dynamic_content.item_clicked","1.0.0",{screen_view_name:e,screen_view_id_type:t,screen_view_id:i,render_id:r,module_id:n,item:s,user_id:a}))}}(s.A),c=new class{constructor(e){this._logCenter=void 0,this._logCenter=e}_isValideLog(e){const{screen_view_name:t,screen_view_id_type:i,screen_view_id:r,render_id:n,module_id:s,item:o,play_type:a,user_id:_}=e;return[t,i,r,n,s,null==o?void 0:o.id,null==o?void 0:o.type,null==o?void 0:o.position,a,_].every(Boolean)}log({screen_view_name:e,screen_view_id_type:t,screen_view_id:i,render_id:r,module_id:n,item:s,play_type:a,user_id:_}){this._isValideLog({screen_view_name:e,screen_view_id_type:t,screen_view_id:i,render_id:r,module_id:n,item:s,play_type:a,user_id:_})&&this._logCenter.log((0,o.L)("dynamic_content.play_clicked","1.0.0",{screen_view_name:e,screen_view_id_type:t,screen_view_id:i,render_id:r,module_id:n,item:s,play_type:a,user_id:_}))}}(s.A);var d=i("7E8A"),p=i("bmsN");let u=function(e){return e.GRID_PLAY="grid_play",e.MASTHEAD_PLAY="masthead_play",e.DIRECT_PLAY="direct_play",e.SHUFFLE="shuffle",e.BOTTOM_SHEET_30S_PREVIEW="bottom_sheet_30s_preview",e}({}),v=function(e){return e.SCREEN_VIEW="screen_view",e.ITEM_CLICKED="item_clicked",e.VIEW_ALL_CLICKED="view_all_clicked",e.PLAY_CLICKED="play_clicked",e}({});const y=(0,r.createContext)({dynamicContentlogAction:()=>{},setDefaultValue:()=>{}}),h=({children:e})=>{const t=p.It.get().user_id,[i,s]=(0,r.useState)(null);return r.createElement(y.Provider,{value:{setDefaultValue:s,dynamicContentlogAction:({action:e,payload:r})=>{const s=d.CONTEXT_PAGE_DYNAMIC_PAGE;switch(e){case v.SCREEN_VIEW:n.A.isAllowed("metric.dynamic_content.screen_view")&&a.log({...i,screen_view_id_type:s,user_id:t,...r});break;case v.VIEW_ALL_CLICKED:n.A.isAllowed("metric.dynamic_content.view_all_clicked")&&_.log({...i,screen_view_id_type:s,user_id:t,...r});break;case v.ITEM_CLICKED:n.A.isAllowed("metric.dynamic_content.item_clicked")&&l.log({...i,screen_view_id_type:s,user_id:t,...r});break;case v.PLAY_CLICKED:n.A.isAllowed("metric.dynamic_content.play_clicked")&&c.log({...i,screen_view_id_type:s,user_id:t,...r})}}}},e)},g=()=>{const e=(0,r.useContext)(y);if(!e)throw new Error("useDynamicContentLogContext must be used within DynamicContentLogProvider");return e}}}]);